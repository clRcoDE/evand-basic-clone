///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////

import axios from "axios"
import cookie from "react-cookies"
import { BaseURL } from "../shared/config"
import { toast } from "react-toastify"
import history from "../shared/BrowserHistory"

// Default config options
const defaultOptions = {
	baseURL: BaseURL,
	headers: {
		"Content-Type": "application/json",
	},
}

// Create instance
let instance = axios.create(defaultOptions)

// Set the AUTH token for any request
instance.interceptors.request.use(function (config) {
	const token = cookie.load("token")
	config.headers.Authorization = token ? `Bearer ${token}` : ""
	return config
})

instance.interceptors.response.use((response) => response, errorResponseHandler)

function errorResponseHandler(error) {
	// check for errorHandle config
	if (
		error.config.hasOwnProperty("errorHandle") &&
		error.config.errorHandle === false
	) {
		return Promise.reject(error)
	}

	if (error.response) {
		if (
			error.response.data.code &&
			error.response.data.code === "token_not_valid"
		) {
			toast.error("ورود شما منقضی شده است. لطفا مجددا ورود کنید.")
			setTimeout(() => {
				cookie.remove("token", { path: "/" })
				history.go("/")
			}, 5000)
		}
	}
}

///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
